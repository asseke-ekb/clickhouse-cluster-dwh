<?xml version="1.0"?>
<clickhouse>
    <!-- ==================== PROFILES ==================== -->
    <profiles>
        <!-- Default profile settings -->
        <default>
            <max_memory_usage>10000000000</max_memory_usage>
            <use_uncompressed_cache>0</use_uncompressed_cache>
            <load_balancing>random</load_balancing>
            <log_queries>1</log_queries>
        </default>

        <!-- ETL Profile: Оптимизирован для массовых вставок -->
        <etl_profile>
            <!-- Ресурсы для ETL -->
            <max_memory_usage>50000000000</max_memory_usage>
            <max_memory_usage_for_user>100000000000</max_memory_usage_for_user>
            <max_execution_time>3600</max_execution_time>

            <!-- Оптимизация для INSERT -->
            <max_insert_threads>16</max_insert_threads>
            <max_insert_block_size>10000000</max_insert_block_size>
            <min_insert_block_size_rows>1000000</min_insert_block_size_rows>
            <min_insert_block_size_bytes>10000000</min_insert_block_size_bytes>
            <insert_quorum>0</insert_quorum>
            <async_insert>1</async_insert>
            <async_insert_threads>8</async_insert_threads>
            <async_insert_max_data_size>100000000</async_insert_max_data_size>

            <!-- Производительность -->
            <max_threads>32</max_threads>
            <priority>1</priority>
            <log_queries>1</log_queries>

            <!-- Без ограничений на чтение -->
            <max_rows_to_read>0</max_rows_to_read>
            <max_bytes_to_read>0</max_bytes_to_read>
            <readonly>0</readonly>
        </etl_profile>

        <!-- Analytics Profile: Баланс между скоростью и ресурсами -->
        <analytics_profile>
            <!-- Умеренные ресурсы -->
            <max_memory_usage>10000000000</max_memory_usage>
            <max_memory_usage_for_user>30000000000</max_memory_usage_for_user>
            <max_execution_time>300</max_execution_time>

            <!-- Оптимизация для чтения -->
            <max_threads>16</max_threads>
            <max_rows_to_read>10000000000</max_rows_to_read>
            <max_bytes_to_read>100000000000</max_bytes_to_read>

            <!-- Настройки -->
            <readonly>1</readonly>
            <priority>3</priority>
            <log_queries>1</log_queries>
            <use_uncompressed_cache>1</use_uncompressed_cache>
            <load_balancing>in_order</load_balancing>

            <!-- Оптимизация для агрегаций -->
            <group_by_overflow_mode>throw</group_by_overflow_mode>
            <max_bytes_before_external_group_by>20000000000</max_bytes_before_external_group_by>
        </analytics_profile>

        <!-- Saqtandyru Reports Profile: Для тяжелых отчетов -->
        <saqtandyru_reports_profile>
            <!-- Большие ресурсы для сложных отчетов -->
            <max_memory_usage>30000000000</max_memory_usage>
            <max_memory_usage_for_user>60000000000</max_memory_usage_for_user>
            <max_execution_time>1800</max_execution_time>

            <!-- Максимум потоков для сложных запросов -->
            <max_threads>24</max_threads>
            <max_rows_to_read>0</max_rows_to_read>
            <max_bytes_to_read>0</max_bytes_to_read>

            <!-- Настройки для больших отчетов -->
            <readonly>1</readonly>
            <priority>5</priority>
            <log_queries>1</log_queries>
            <use_uncompressed_cache>1</use_uncompressed_cache>

            <!-- Оптимизация для больших JOIN -->
            <max_bytes_in_join>10000000000</max_bytes_in_join>
            <join_algorithm>auto</join_algorithm>
            <partial_merge_join_optimizations>1</partial_merge_join_optimizations>

            <!-- External processing -->
            <max_bytes_before_external_group_by>30000000000</max_bytes_before_external_group_by>
            <max_bytes_before_external_sort>30000000000</max_bytes_before_external_sort>
        </saqtandyru_reports_profile>

        <!-- Admin Profile: Без ограничений -->
        <admin_profile>
            <max_memory_usage>0</max_memory_usage>
            <max_execution_time>0</max_execution_time>
            <max_rows_to_read>0</max_rows_to_read>
            <max_bytes_to_read>0</max_bytes_to_read>
            <readonly>0</readonly>
        </admin_profile>
    </profiles>

    <!-- ==================== QUOTAS ==================== -->
    <quotas>
        <!-- Default quota: no restrictions -->
        <default>
            <interval>
                <duration>3600</duration>
                <queries>0</queries>
                <errors>0</errors>
                <result_rows>0</result_rows>
                <read_rows>0</read_rows>
                <execution_time>0</execution_time>
            </interval>
        </default>

        <!-- ETL Quota: Без ограничений для массовых операций -->
        <etl_quota>
            <interval>
                <duration>3600</duration>
                <queries>0</queries>
                <errors>0</errors>
                <result_rows>0</result_rows>
                <read_rows>0</read_rows>
                <execution_time>0</execution_time>
            </interval>
        </etl_quota>

        <!-- Analytics Quota: Много небольших запросов -->
        <analytics_quota>
            <interval>
                <duration>3600</duration>
                <queries>10000</queries>
                <errors>100</errors>
                <result_rows>100000000</result_rows>
                <read_rows>10000000000</read_rows>
                <execution_time>36000</execution_time>
            </interval>
        </analytics_quota>

        <!-- Saqtandyru Reports Quota: Мало тяжелых запросов -->
        <saqtandyru_reports_quota>
            <interval>
                <duration>3600</duration>
                <queries>100</queries>
                <errors>10</errors>
                <result_rows>0</result_rows>
                <read_rows>0</read_rows>
                <execution_time>0</execution_time>
            </interval>
            <!-- Дневной лимит -->
            <interval>
                <duration>86400</duration>
                <queries>500</queries>
                <errors>50</errors>
                <result_rows>0</result_rows>
                <read_rows>0</read_rows>
                <execution_time>0</execution_time>
            </interval>
        </saqtandyru_reports_quota>
    </quotas>

    <!-- ==================== USERS ==================== -->
    <users>
        <!-- Default user для внутреннего использования -->
        <default>
            <password></password>
            <networks>
                <ip>::1</ip>
                <ip>127.0.0.1</ip>
            </networks>
            <profile>default</profile>
            <quota>default</quota>
        </default>

        <!-- ETL User -->
        <etl>
            <password>etl_secure_pass_2024</password>
            <networks>
                <ip>::/0</ip>
            </networks>
            <profile>etl_profile</profile>
            <quota>etl_quota</quota>
        </etl>

        <!-- Analytics User -->
        <analytics>
            <password>analytics_secure_2024</password>
            <networks>
                <ip>::/0</ip>
            </networks>
            <profile>analytics_profile</profile>
            <quota>analytics_quota</quota>
        </analytics>

        <!-- Saqtandyru Reports User -->
        <saqtandyru_reports>
            <password>saqtandyru_reports_2024</password>
            <networks>
                <ip>::/0</ip>
            </networks>
            <profile>saqtandyru_reports_profile</profile>
            <quota>saqtandyru_reports_quota</quota>
        </saqtandyru_reports>

        <!-- Admin User -->
        <admin>
            <password>admin_super_secure_2024</password>
            <networks>
                <ip>::/0</ip>
            </networks>
            <profile>admin_profile</profile>
            <quota>default</quota>
            <access_management>1</access_management>
        </admin>
    </users>
</clickhouse>