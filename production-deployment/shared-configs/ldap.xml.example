<?xml version="1.0"?>
<clickhouse>
    <!-- LDAP Configuration для доменной аутентификации -->
    <ldap_servers>
        <my_ldap_server>
            <!-- Адрес LDAP/AD сервера -->
            <host>ldap.company.local</host>
            <port>389</port>

            <!-- Для LDAPS (рекомендуется в production) -->
            <!-- <port>636</port> -->
            <!-- <enable_tls>yes</enable_tls> -->
            <!-- <tls_require_cert>demand</tls_require_cert> -->

            <!-- Bind credentials для поиска пользователей -->
            <bind_dn>CN=clickhouse-svc,OU=Service Accounts,DC=company,DC=local</bind_dn>

            <!-- !!! ВАЖНО: Заменить на реальный пароль служебной учетки !!! -->
            <bind_password>SERVICE_ACCOUNT_PASSWORD_HERE</bind_password>

            <!-- Base DN для поиска пользователей -->
            <user_dn_detection>
                <base_dn>OU=Users,DC=company,DC=local</base_dn>
                <search_filter>(&amp;(objectClass=user)(sAMAccountName={user_name}))</search_filter>
            </user_dn_detection>

            <!-- Timeout настройки -->
            <verification_cooldown>300</verification_cooldown>
            <operation_timeout>10</operation_timeout>
            <connection_timeout>5</connection_timeout>
            <enable_tls>no</enable_tls>
        </my_ldap_server>
    </ldap_servers>

    <!-- Маппинг LDAP групп на роли ClickHouse -->
    <user_directories>
        <ldap>
            <server>my_ldap_server</server>

            <!-- Маппинг ролей по группам AD -->
            <role_mapping>
                <!-- Аналитики: группа AD -> роль ClickHouse -->
                <base_dn>OU=Groups,DC=company,DC=local</base_dn>
                <search_filter>(&amp;(objectClass=group)(member={user_dn}))</search_filter>
                <attribute>cn</attribute>
                <prefix>ROLE_</prefix>

                <!-- Примеры:
                     AD группа "ClickHouse-Analytics" -> роль "ROLE_ClickHouse-Analytics"
                     AD группа "ClickHouse-Reports" -> роль "ROLE_ClickHouse-Reports"
                -->
            </role_mapping>
        </ldap>
    </user_directories>
</clickhouse>
